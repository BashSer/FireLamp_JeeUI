| __[README](/README.md)__ | __[CHANGELOG](/CHANGELOG.md)__ |

# Управление лампой

## Содержание

 - [Управление кномкой](#по-кнопке)
 - [Энкодер](#энкодер)
 - [Управление через HTTP/MQTT](#по-http)
 - [служебные http запросы](#cлужебные-http-вызовы)


### По кнопке:
* Из выключенного состояния
   - 1 касание - включить на последнем эффекте
   - 2 касания - включить в режиме ДЕМО
   - долгое удержание - включить в режиме "белая лампа" на минимальную яркость (ночник)
   - касание, удержание - включить в режиме "белая лампа" на максимальную яркость
* Во включенном состоянии
   - 1 касание - выключить лампу
   - 2 касания - следующий эффект
   - 3 касания - предыдущий эффект
   - 5 касаний - вывод IP на лампу
   - 6 касаний - вывод текущего времени бегущей строкой
   
   - удержание - регулировка яркости
   - 1 касание, удержание - регулировка "скорости" эффекта
   - 2 касания, удержание - регулировка "масштаба" эффекта
   
Это дефолтное состояние для кнопки, но абсолютно любую настройку можно поменять

### Энкодер
Управление энкодером управляется аналогично использованию обычной кнопкой, плюс действия при поворотах и действия при повороте с нажатием
 - поворот во включенном состоянии изменяет яркость с шагом в единицу
 - долгое нажатие - переход в управление контролами текущего эффекта
    - поворот - инкремент/декремент значения текущего контрола
    - одиночное нажатие - циклический переход между контролами текущего эффекта
    - выход из режима управления осуществляется автоматически спустя заданный интервал времени

### По HTTP/MQTT
команды можно посылать на лампу через браузер или curl по URL вида http://esp-xxxxxx/cmd?arg=param
   - `/cmd?on` `/cmd?off` `/cmd?on=true` `/cmd?on=false` - вкл/выкл
   - `/cmd?demo` - режим ДЕМО
   - `/cmd?g_bright` `/cmd?g_bright=true` - проверка/установка для глобальной яркости
   - `/cmd?msg=Hello` - вывод сообщения на лампу
   - `/cmd?g_brtpct` `/cmd?g_brtpct=0-100` - получить/установить яркость в процентах
   - `/cmd?bright=0-255` - яркость
   - `/cmd?speed=0-255` - скорость
   - `/cmd?scale=0-255` - шкала
   - `/cmd?effect=N` - эффект номер N
   - `/cmd?move_next` - следующий эффект
   - `/cmd?move_prev` - предыдущий эффект
   - `/cmd?move_rnd` - случайный эффект
   - `/cmd?effect` - номер текущего эффекта
   - `/cmd?warning` `/cmd?warning=[16777215,5000,500]` - неблокирующий вывод мигалки поверх эффекта (выдача предупреждений)
   - `/cmd?alarm=true` - форсировать включение будильника
   - `/cmd?dynCtrlX` , к примеру cmd?dynCtrl5=123 - получить/установить значение дин. контрола
   - `/cmd?reboot` - перезагрузить лампу
   - `/cmd?mp3_vol` - установить громкость мп3-плеера

так же команды можно объединять в цепочки в одной посылке, т.е. допустим включить лампу, установить яркость, перейти к эффекту
аналогичные команды работают и для MQTT, если чего-то не хватает или что-то не получается - спрашивайте в теме

### Cлужебные http вызовы:

   - `/heap` - показать свободное место на куче
   - `/echo` - показать эхо-ответ (json для формирования интерфейса)
   - `/config` - показать текущий конфиг (json основных настроек)
   - `/config.json` - скачать системный конфиг лампы с файловой системы
   - `/events_config.json` - скачать активный конфиг событий
   - `/update` - форма http-обновления прошивки
   - `/edit` - вызов редактора конфигов (esp8266/esp8266 - логин/пассворд)
