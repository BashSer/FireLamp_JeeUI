# Change Log

## v3.1.0 (2023-05-16)
 - исправлены проблемы сборки под обновленный фреймворк есп32 и платформу есп32 v6.1.7
 - введен класс кадрового CRGB буфера абстрагирующий топологию и тип устройства вывода
   - буфер допускает привязку/отвязку от FastLED, копирование, атомарный обмен и общие операции над RGB массивом
   - методы обращения к буферу и транляции под топологию матрицы из EffectMath упразднены в пользу работы через LedFB
   - буфера лампы под слои текста/рисовалки переведены на использование экземпляров LedFB, часть операций копирования заменена атомарной заменой
   - убраны флаги зеркалирования из объекта лампы, топология определяеся конфигурацией буфера
 - изменения в коде эффектов
   - множество эффектов переработанно с использованием структур сущностей и стандартных контейнеров
   - оптимизация использования памяти для эффектов
      - для части эффектов убраны излишние буфера и промежуточное копирование
      - эффекты с переменным числом объектов, вместе с изменением числа сущностей растет/уменьшается их контейнер вместо использования фиксированных массивов
   - промежуточные двумерные массивы для эффектов унифицированы в абстрактный шаблон Vector2D
   - переработаны эффекты на основе Noise3D Map
     - Noise3D Map выделен в отдельный класс с собственным буфером
     - унифицирован метод регенерации шума
   - переработан класс Boid и зависимые от него эффекты, убраны зависимость от статических макросов WIDTH/HEIGHT, добавлен контейнер для объектов стаи
   - все эффекты переведены на работу через фреймбуфер
      - убраны зависимости от макросов WIDTH/HEIGHT
      - убраны зависимости от статических констант/макросов производных WIDTH/HEIGHT
      - убраны все прямые обращения к глобальному экземпляру класса FastLED
   - весь код кроме объекта LedFB избавлен от зависимости на статические макросы WIDTH/HEIGHT и их производные

## v3.0.0 (2023-04-07) первый выпуск прокта после форка
 - добавлена http/mqtt команда для регулировки яркости лампы в процентах 0-100
 - добавлена http/mqtt команда для регулировки громкости мп3 плеера
 - добавлен класс Effcfg для управления конфигурацией эффектов, упразднены операции с создание тяжелых экземпляров класса EffectWorker при копировании конфигураций эффектов, работе затухания и пр.
 - раскрыто системное меню по-умолчанию, упразднена опция сборки 'SHOWSYSCONFIG'
 - при сборке с плеером настройки DFPlayer'а всегда показываются в WebUI, независимо от того подключен ли плеер
 - значики микрофона и нумерация эффектов в списках включена по-умолчанию, убрана опция, поозволяющая отключать эти символы
 - реализована буферизованная запись при генерации кеш-файлов и индекса на ФС
 - значительное ускорение процедур генерации кеш-файлов и индекса на ФС
 - упраздены кривые схемы и разнобой с медленной/быстрой/отложенной генерацией файлов списков эффектов, используется один унифицированный генератор
 - переработана схема подрузки конфигурации и переключения эффектов, устранены дублирующие вызовы, оптимизированна работа с файлами
 - реализовано корректное кеширование списков эффектов на стороне браузера, устранены излишние подгрузки в случае если списки не изменялись
 - переработан класс реализующий плавное изменение яркости
 - оптимизирована mqtt публикация, в случае если нет подключения с серверу, попытки публикации отменяются
 - оптимизированы классы GradientPaletteList, GradientPalette
 - удалена поддержка протокола ArduinoOTA, успользуется обновление через http
 - влит код из репозитория andy040670 примерно от 2021 года, устранены ошибки сборки
 - переработаны списки контролов UIControl
    - указатели заменены на smartpointers, реализованы конструкторы копирования, глубокие копии списков, устранение утечек памяти, ошибки работы с памятью, висячие указатели
 - к репозиторию настроена CI сборка
 - переработаны скрипты установки/сборки для windows (спасибо andy040670)
    - добавлены переменные для путей к репозиториям и зависимостям
    - убрана зависимость от внешней утилиты wget.exe
 - реструктуризация кода, файлов, сторонних бибилиотек
    - некоторые сторонние библиотеки убраны из репозитория и заменены внешними зависимостями
    - переименованы констатны TCONST_00XX, CMD_* в человекочитаемый вид
    - переименованы множество имен переменных, классов, макросов в соответсвии с общепринятым стилем
    - переработаны заголовочные файлы, перенесены определения и декларации в соответсвии с логической принадлежностью файлов, код методов перенесен в соответствующие cpp файлы
    - переработаны инклюды заголовочных файлов в соответсвии с минимально необходимыми зависимостями
    - из репозитория удалены посторонние бинарные файлы
 - исправлены множество ошибкок в коде работы с эффектами - вылеты за границы массивов, деление на ноль, утечки и излишний расход памяти, оптимизация циклов и т.п.
    - EffectSplashBals
    - EffectOsc
    - EffectLeapers
    - EffectPicasso
    - EffectMagma
    - EffectNexus
    - EffectLiquidLamp
    - EffectPicasso
    - EffectSmokeballs
    - EffectBBalls
    - EffectMaze
    - EffectWrain
    - Puzzle
    - EffectSmokeballs
    - EffectPolarL
    - EffectPacific
    - EffectStarShips
    - EffectFire2021
    - EffectCube2d
    - EffectPopcorn
    - EffectPuzzles
    - EffectRadialFire
    - EffectWcolor
